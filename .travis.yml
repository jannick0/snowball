language: c

dist: trusty

os:
- windows

before_install:
  - test -f C:/tools/msys64/msys2_shell.cmd && echo "msys2_shell.cmd found" || rm -rf C:/tools/msys64
  - choco uninstall -y mingw
  - choco upgrade --no-progress -y msys2
  - echo $PATH
  - export msys2='cmd //C RefreshEnv.cmd & SET MSYSTEM=MSYS& SET CHERE_INVOKING=1& C:\\tools\\msys64\\usr\\bin\\bash -li -c "\$@"'
  - $msys2 pacman --sync --noconfirm --needed base base-devel msys2-devel
  - $msys2 pacman --sync --noconfirm --needed mingw-w64-i686-toolchain mingw-w64-i686-make
  - $msys2 pacman --sync --noconfirm --needed mingw-w64-x86_64-toolchain mingw-w64-x86_64-make
  - taskkill //IM gpg-agent.exe //F  # https://travis-ci.community/t/4967
  - export MAKE=mingw32-make

install:
  - export MAKEFLAGS="-j $(nproc)"

script:
  - $MAKE CC="${CC:-gcc}$cc_append"
  - test -z "$c_tests" || $MAKE check CC="${CC:-gcc}$cc_append" STEMMING_DATA=snowball-data
  - test -z "$PYTHON"  || $MAKE check_python python="$PYTHON" STEMMING_DATA=snowball-data
  - test -z "$JAVA" -o -z "$JAVAC" || $MAKE check_java STEMMING_DATA=snowball-data
  - test -z "$MCS"     || $MAKE check_csharp MCS="$MCS" STEMMING_DATA=snowball-data
  - test -z "$NODE"    || $MAKE check_js     STEMMING_DATA=snowball-data
  - test -z "$RUST"    || $MAKE check_rust   STEMMING_DATA=snowball-data
  - test -z "$RUST"    || $MAKE check_rust cargoflags=--release STEMMING_DATA=snowball-data
  - test -z "$GO"      || $MAKE check_go     STEMMING_DATA=snowball-data
  - test -z "$FPC"     || $MAKE check_pascal STEMMING_DATA=snowball-data
